<script>
  document.addEventListener('click', function (e) {
    const link = e.target.closest('a');
    if (!link) return;

    const href = link.href;
    if (!href.includes('webtoons.com')) return;

    e.preventDefault();

    let titleNo = null;

    try {
      const url = new URL(href);
      titleNo = url.searchParams.get('title_no');
    } catch (err) {
      console.error('URL invalide', err);
    }

    // Deep link officiel Webtoon
    const appUrl = titleNo
      ? `linewebtoon://title/list?titleNo=${titleNo}`
      : `linewebtoon://`;

    // Tentative ouverture app
    window.location.assign(appUrl);

    // Fallback web si app absente
    setTimeout(() => {
      window.location.assign(href);
    }, 800);
  }, true);
</script>
